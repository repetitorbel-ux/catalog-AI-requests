# Архитектура проекта: Каталог запросов

## Технологический стек и версии
- **Backend:** Python 3.11, Flask 2.x
- **База данных:** PostgreSQL (+ psycopg2-binary), SQLAlchemy (Flask-SQLAlchemy)
- **Фронтенд:** Vanilla JS, CSS Flexbox
- **Тестирование:** Pytest, pytest-flask
- **Окружение:** Conda (`catalog_env`)
- **Резервное копирование:** Нативные утилиты PostgreSQL (`pg_dump`, `pg_restore`)

## Ключевые компоненты и паттерны

### `app.py`
- **Паттерн:** Фабрика приложений (`create_app()`)
- **Назначение:** Точка входа. Инициализирует конфиг, БД, регистрирует blueprints.
- **Важно:** Для тестов создается отдельный экземпляр приложения с тестовой конфигурацией.

### `config.py`
- **Содержит:** `SECRET_KEY`, `SQLALCHEMY_DATABASE_URI`
- **Важно:** Для подключения к БД используется строка из переменной окружения `DATABASE_URL`. Конфиг адаптирован для serverless-БД (пулы соединений, `SQLALCHEMY_POOL_RECYCLE`, `SQLALCHEMY_POOL_PRE_PING`).
- **Пути:** `BACKUP_DIR` для бэкапов, `MARKDOWN_FILE` для экспорта.

### `models.py`
- **Сущности:** `Category` -> `Subcategory` -> `Entry` -> `Url`
- **Связи:** Иерархические `one-to-many` с каскадным удалением (`cascade='all, delete-orphan'`).
- **Поля:** Основные поля `name`, `description` (для `Url`), связи `foreign_key`.

### `routes.py`
- **Структура:** Все эндпоинты сгруппированы в Blueprint `catalog_bp`.
- **Функционал:** 
  - CRUD для всех сущностей (категории, подкатегории, записи, URL)
  - AJAX-эндпоинты (`/get_subcategories`, `/get_entries`)
  - Сервисные эндпоинты (`/backup`, `/restore`, `/export`)
- **Важно:** Используются flash-сообщения для уведомлений пользователя.

### `utils.py`
- **Содержит:** Функции `create_backup()` и `restore_backup()`.
- **Реализация:** Используются нативные утилиты PostgreSQL, вызываемые через `subprocess`.
- **Безопасность:** Аутентификация через переменные окружения из `SQLALCHEMY_DATABASE_URI`.

### `templates/interface.html`
- **Особенность:** Весь интерфейс — один файл. Содержит встроенный JS для динамики.
- **Структура:** Вкладки для различных операций (добавление, редактирование, удаление, бэкап).

### `static/style.css`
- **Подход:** Flexbox для layout.
- **Содержит:** Стили для всех элементов интерфейса, включая состояния (hover, active) и flash-сообщения.

### `tests/test_app.py`
- **Стратегия:** Использует фабрику приложений и БД SQLite в памяти для изоляции тестов.
- **Покрытие:** Базовые тесты главной страницы и операций добавления.