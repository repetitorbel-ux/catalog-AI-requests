# Правила разработки и Code Style

## Общие принципы
1.  **Читаемость важнее краткости.** Пиши код, понятный новичку во Flask.
2.  **Следуй существующей структуре.** Не меняй архитектуру без крайней необходимости.
3.  **Все изменения должны быть протестированы.** Если добавляешь эндпоинт — напиши для него тест.
4.  **Документируй изменения.** Любое значительное изменение должно отражаться в `ARCHITECTURE.md`.

## Стиль кода (Python/Flask)
-   **Импорты:** Группируй: стандартная библиотека, сторонние, свои модули.
-   **Именование:** `snake_case` для переменных и функций, `CamelCase` для классов.
-   **SQLAlchemy:** Используй `Model.query.filter_by(...).first()`, а не `session.query(Model)...`.
-   **Валидация:** Всегда проверяй входящие данные из форм и AJAX-запросов.
-   **Обработка ошибок:** Обертывай операции с БД в `try...except`. Для AJAX возвращай JSON с полем `error`.

## Стиль кода (JavaScript)
-   **Чистота:** Весь новый JS-код выноси в `static/js/main.js`. Не оставляй код в HTML.
-   **AJAX:** Обрабатывай ошибки и показывай пользователю уведомление.
-   **Именование:** `camelCase` для переменных и функций.
-   **События:** Используй делегирование событий для динамических элементов.
-   **Безопасность:** Избегай `innerHTML`. Используй `textContent` или санитизацию.

## Работа с базой данных
-   **Сессии:** Используй сессию, полученную через `db.session`.
-   **Целостность:** Полагайся на каскадное удаление, настроенное в моделях.
-   **Эффективность:** Избегай N+1 запросов. Используй жадную загрузку (`.options(joinedload(...))`) при необходимости.

## Работа с фронтендом
-   **SPA принцип:** Все действия через AJAX без перезагрузки страницы.
-   **Состояние интерфейса:** После CRUD-операций интерфейс должен сохранять состояние (выбранную сущность).
-   **Визуальный отклик:** Важные действия (удаление) требуют подтверждения. Показывай индикаторы загрузки.

## Запрещенные практики
-   **Не меняй** логику бэкапа/восстановления в `utils.py` без согласования.
-   **Не удаляй** существующие эндпоинты, только добавляй новые или модифицируй старые.
-   **Не хардкодь** конфигурацию. Используй переменные окружения.